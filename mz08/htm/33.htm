<html><head><meta http-equiv=Content-Type content="text/html; charset=iso-8859-2"><link rel=stylesheet href=magazin.css TYPE=text/css><title>MagaZin #8 :: luty 2002</title></head><body link=#478DE7 vlink=#478DE7 alink=#478DE7 topmargin=0 bottommargin=0 bgcolor=#000000><div align=center><center><table border=0 width=650 style="border-style: solid; border-width: 0" cellspacing=0 cellpadding=0 height=100% bgcolor=#FFFFFF><tr><td width=100% height=20 valign=top></td></tr></center><tr><td width=100% height=25 valign=middle bgcolor=#4048A8><div align=center><table border=0 width=583 cellspacing=0 cellpadding=0><center><td width=400 class=9ptV valign=bottom colspan=3><p class=9ptV><font color=#FFFFFF><b>MAGAZIN #8 :: STRONA 33</b></font></td></center><td width=133 class=9ptV valign=bottom><p align=right><font color=#FFFFFF><img border=0 src=../img/direct.gif width=7 height=10><img border=0 src=../img/direct3.gif width=7 height=10><img border=0 src=../img/direct2.gif width=7 height=10></font></td><center><td width=8 class=9ptV valign=bottom></td><td width=55 class=9ptV><b><font color=#FFFFFF>INTERNET</font></b></td></table></center></div></td></tr><center><tr><td width=100% height=5 valign=top><p class=9ptV>&nbsp;</td></tr><tr><td width=100% height=20 valign=bottom></center><div align=center><table border=0 width=586 height=20 cellspacing=0 cellpadding=0><tr><td width=135 background=../img/line3.gif><p align=right><img border=0 src=../img/line.gif width=9 height=20></td><center><td width=310 valign=bottom><p align=center class=9ptV><a href=32.htm class=link2><font color=#4048A8>poprzednia strona</font></a><font color=#4048A8> :: </font><a href=spis.htm class=link2><font color=#4048A8>spis tre¶ci</font></a><font color=#4048A8> :: </font><a href=34.htm class=link2><font color=#4048A8>nastêpna strona</font></a></td><td width=135 background=../img/line3.gif><img border=0 src=../img/line2.gif width=9 height=20></td></tr></table></center></div></td></tr><center><tr><td width=100% height=5 valign=top><p class=9ptV>&nbsp;</td></tr><tr><td width=100% height=21 valign=top><div align=center><center><table border=0 width=600 cellspacing=0 cellpadding=6 height=20 bgcolor=#FFFFFF><tr><td width=285 height=20 valign=top class=9pt><div align=center><center><table border=0 width=100% cellspacing=0 cellpadding=0><tr><td width=100% valign=top class=9ptV height=15><i>Alternatywa odbierania poczty e-mail</i></td></tr><tr><td width=100%><p class=u>Poczta przez Telnet</td></tr></table></center></div><div align=justify><p class=9ptV><font color=#000000>Piszê ten tekst, poniewa¿ wielu z was (u¿ytkowników Sieci) nie potrafi (lub szuka informacji) na temat, który chcia³bym w miarê szczegó³owo omówiæ w jednym tek¶cie, jako ¿e takiej pracy, rozpatruj±cej temat dok³adnie, nie napotka³em jeszcze. Nie bêdê siê rozwodzi³ nad tym, jakie korzy¶ci to przynosi, je¶li kto¶ takowych nie widzi, niech nadal u¿ywa LookOut'a :), ale zatrzyma ten tekst, bo pó¼niej na pewno (?) mu siê przyda. Dla zainteresowanych zdecydowa³em siê napisaæ ten w³a¶nie skromny dokument.<br> <br> <b>Protoko³y przesy³u poczty</b><br> <br> Poczta przesy³ana jest przez Internet przy pomocy dwóch bardzo prostych protoko³ów - SMTP (Simple Mail Transmission Protocol) oraz, najczê¶ciej choæ niekoniecznie, POP3 (Post Office Protocol ver. 3). Ogólnie rzecz ujmuj±c, ca³a sprawa opiera siê na dialogu z serwerem przy pomocy serii znaków ASCII zakoñczonych znakiem 1013 (CRLF). To co wysy³a klient to tzw. polecenie, to co serwer - odpowied¼. Serwer nigdy nie wysy³a odpowiedzi nie proszony o ni±, odpowied¼ jest zawsze jedynie reakcj± na polecenie. Polecenia i odpowiedzi sk³adaj± siê na dialog. Teraz przejdê ju¿ do konkretów.<br> <br> <b>Konkrety</b><br> <br> <u>1. Wysy³anie poczty - SMTP</u><br> <br> Na protokole SMTP opiera siê ca³y system przesy³ania wiadomo¶ci e-mail. Standardowo przypisuje siê mu 25 port i z tym portem serwera pocztowego nale¿y siê ³±czyæ. Telnetujemy siê zatem na rzeczony port serwera pocztowego i co dalej? Dalej trzeba siê przywitaæ :). HELO nazwa.domeny. W ten sposób przedstawiamy siê serwerowi pocztowemu, choæ argument nie zawsze jest wymagany (czasami wystarcza samo HELO). Je¶li serwer "przyjmie nas" odpowie kodem 250, w innym przypadku mo¿e zwróciæ b³êdy o kodach: 421, 500, 501, 504 (kody odpowiedzi omówiê w dalszej czê¶ci dokumentu). MAIL FROM:adres@zwrotny. Poleceniem tym rozpoczynamy procedurê wysy³ania wiadomo¶ci. Adres@zwrotny to nic innego jak podawany przez nas adres nadawcy listu (mo¿e byæ dowolny, ale w formacie nazwa@dome.na). Je¶li wszystko pójdzie OK, serwer odpowie kodem 250, w przeciwnym przypadku bêd± to odpowiedzi: 552, 451, 452 lub 500, 501, 421. RCPT to:adres@docelowy. Tym poleceniem okre¶lamy adresata naszej wiadomo¶ci, mo¿e ono byæ u¿yte kilka razy je¶li jest wiêcej ni¿ jeden adresat. Adres@docelowy to po prostu adres e-mail adresata naszej wiadomo¶ci. Je¶li bêdzie OK to serwer odpowie kodem 250, 251, w przeciwnym przypadku mog± wyst±piæ odpowiedzi o kodach: 550, 551, 552, 553, 450, 451, 452 lub 500, 501, 503, 421. DATA. Po tym poleceniu mo¿emy zacz±æ wpisywaæ tre¶æ naszej wiadomo¶ci. Zakoñczenie tekstu stanowi "." (kropka) jako jedyny znak w linii. Polecenie to jest jednocze¶nie komend± koñcz±c± ca³± transakcjê przesy³ania wiadomo¶ci. Poprawn± odpowiedzi± serwera, przed podaniem tre¶ci wiadomo¶ci, bêdzie 354, b³êdn± - 451, 554 lub 500, 501, 503, 421. Po odpowiedzi poprawnej wpisujemy tre¶æ mail'a i po jej zakoñczeniu znowu otrzymujemy odpowied¼ serwera - poprawn± 250, niepoprawn±: 552, 554, 451, 452. RSET. To jest polecenie, którego zadaniem jest przerwanie rozpoczêtej transakcji przesy³ania wiadomo¶ci. W rezultacie mo¿emy uzyskaæ odpowiedzi o nastêpuj±cych kodach: 250 je¶li wszystko OK, w przeciwnym wypadku 500,501,504, 421. QUIT. T± komend± koñczymy dialog z serwerem. Po jego wydaniu serwer po¿egna siê z nami wysy³aj±c odpowied¼ o kodzie 221. I jeszcze jedna komenda, której sensu szczerze mówi±c nie rozumiem, ale podajê j± dla porz±dku :) NOOP. Polecenie to nie robi nic :)). Po nim serwer zwraca odpowied¼ 250 je¶li wszystko jest OK, je¶li nie, to 500, 421.&nbsp;<br> <br> <u>1a. Kody odpowiedzi serwera</u><br> <br> Wszystkie kody s± trzycyfrowe. Najwa¿niejsze s± jednak dwie pierwsze cyfry (znaczenie trzeciej jest nieokre¶lone). 2xx - wszystko OK, 3xx - czê¶ciowo OK, serwer czeka na dodatkowe dane, 4xx - odpowied¼ tylko chwilowo negatywna (w danym momencie serwer nie mo¿e zrealizowaæ ¿±dania), 5xx - b³±d, x0x - b³±d sk³adni, x1x - informacja, x2x - odnosi siê do po³±czenia, x3x - nieokre¶lone, x4x - nieokre¶lone, x5x - odnosi siê do statusu serwera. Teraz konkretne kody:<br> <br> 221 - informacja o systemie lub pomoc<br> 214 - pomoc<br> 220 - powitanie serwera<br> 221 - po¿egnanie serwera<br> 250 - przyjêcie wiadomo¶ci do wys³ania<br> 251 - podany adres odbiorcy jest nieaktualny, ale serwer przekierowuje wiadomo¶æ pod nowy adres<br> 354 - oczekiwanie na tekst wiadomo¶ci<br> 421 - sesja zostanie przerwana przez serwer (przyczyna nieokre¶lona)</font></div></td><td width=285 height=20 valign=top class=9pt><div align=justify><p class=9ptV><font color=#000000>450 - chwilowo wiadomo¶æ nie mo¿e byæ wys³ana<br> 451 - wysy³anie wiadomo¶ci przerwane<br> 452 - wiadomo¶æ nie mo¿e byæ wys³ana z powodu braku pamiêci<br> 500 - nie ma takiego polecenia<br> 501 - b³±d sk³adni polecenia<br> 502 - polecenie rozpoznane, ale nieobs³ugiwane<br> 503 - b³±d w kolejno¶ci poleceñ<br> 504 - podany parametr jest nieobs³ugiwany<br> 550 - nie mo¿na wys³aæ wiadomo¶ci<br> 551 - podany adres odbiorcy jest nieaktualny, serwer zna nowy, ale nie mo¿e przekierowaæ<br> 552 - wiadomo¶æ nie mo¿e byæ0 wys³ana z powodu braku pamiêci<br> 553 - b³±d w adresie odbiorcy<br> 554 - niepoprawnie wykonana transakcja<br> <br> No i to by³oby na tyle je¶li chodzi o wysy³anie wiadomo¶ci. Teraz czas przej¶æ do protoko³u odbioru poczty POP3.<br> <br> <u>2. Odbieranie poczty - POP3</u><br> <br> No dobra, mamy jak±¶ skrzynkê pocztow±, umiemy wysy³aæ pocztê, ale czasem kto¶ do nas co¶ napisze i dobrze by³oby to przeczytaæ :). Telnetujemy siê na port 110 i zaczyna siê zabawa :). W przypadku tego protoko³u serwer nie zwraca odpowiedzi z ¿adnymi kodami liczbowymi, je¶li posz³o OK to odpowied¼ brzmi "+OK komunikat", a w razie b³êdu "-ERR komunikat"<br> <br> </font><font color=#4048A8><b>USER nazwa<br> </b></font><font color=#000000><br> Najpierw nale¿y podaæ nazwê u¿ytkownika (czyli to co mamy przed @ w adresie skrzynki :)).<br> <br> </font><font color=#4048A8><b>PASS haslo<br> </b></font><font color=#000000><br> Po podaniu nazwy u¿ytkownika trzeba podaæ has³o jakie ustalili¶my dla naszej skrzynki.<br> <br> </font><font color=#4048A8><b>STAT<br> </b></font><font color=#000000><br> Polecenie to jest pytaniem o zawarto¶æ skrzynki u¿ytkownika. W odpowiedzi otrzymujemy "+OK a b", gdzie a - ilo¶æ wiadomo¶ci, b - ³±czny rozmiar wszystkich wiadomo¶ci w bajtach.&nbsp;<br> <br> </font><font color=#4048A8><b>LIST x<br> </b></font><font color=#000000><br> Poleceniem tym sprawdzamy rozmiar wiadomo¶ci nr x, lub wszystkich (w postaci listy) je¶li nie podali¶my argumentu. Odpowiedz serwera to "+OK x b", gdzie x to podany numer wiadomo¶ci, a b - rozmiar w bajtach<br> <br> </font><b><font color=#4048A8>RETR x<br> </font></b><font color=#000000><br> W ten sposób odczytujemy wiadomo¶æ nr x (wiadomo¶æ ta nie mo¿e byæ oznaczona do usuniêcia). Je¶li nie wyst±pi b³±d to otrzymamy odpowiedz "+OK b", gdzie b to rozmiar wiadomo¶ci w bajtach, pod spodem bêdzie tre¶æ<br> <br> </font><b><font color=#4048A8>DELE x<br> </font></b><font color=#000000><br> Tym poleceniem zaznaczamy wiadomo¶æ x do usuniêcia. To nie powoduje natychmiastowego usuniêcia, stan zostanie uaktualniony dopiero po wydaniu polecenia QUIT koñcz±cego dialog (wiadomo¶æ zostanie wtedy fizycznie skasowana)<br> <br> </font><b><font color=#4048A8>RSET</font></b><font color=#000000><br> <br> Polecenie to odznacza wiadomo¶ci do usuniêcia<br> <br> </font><b><font color=#4048A8>QUIT</font></b><font color=#000000><br> <br> Komenda ta koñczy dialog i po usuniêciu zaznaczonych wiadomo¶ci zrywa po³±czenie<br> <br> </font><b><font color=#4048A8>NOOP</font></b><font color=#000000><br> <br> To znowu polecenie, które nie robi nic, ale za to zawsze daje odpowied¼ pozytywn± :).&nbsp;<br> <br> To tyle je¶li chodzi o polecenia podstawowe, które na pewno obs³ugiwane s± przez ka¿dy serwer POP3. Omówiê jeszcze kilka dodatkowych, które uwa¿am za u¿yteczne, aczkolwiek istnieje szansa, ¿e konkretny serwer nie bêdzie ich rozpoznawa³.<br> <br> </font><font color=#4048A8><b>APOP nazwa zaszyfrowane_haslo</b></font><font color=#000000><br> <br> To alternatywa dla poleceñ USER i PASS. Przesy³a ona has³o w postaci zaszyfrowanej (w przeciwieñstwie do PASS). K³opot polega na tym, ¿e jako drugi argument musimy podaæ has³o ju¿ zaszyfrowane :). Sprawa szyfrowania tego has³a zajmê siê nieco pó¼niej<br> <br> </font><b><font color=#4048A8>TOP x y</font></b><font color=#000000><br> <br> Polecenie dzia³a podobnie do RETR, z t± ró¿nic±, ¿e wy¶wietla tylko nag³ówek i y pocz±tkowych linii wiadomo¶ci nr x.&nbsp;<br> <br> I to wszystko co trzeba wiedzieæ, ¿eby wymieniaæ pocztê pos³uguj±c siê jedynie telnetem.<br></font></div></center></center><div align=justify><p class=9ptV align=right><font color=#000000><b>Tyboer<br> </b></font><a href=http://www.hacking.pl class=link2><font color=#4048A8>www.hacking.pl</font></a><br></div><center><center></center></center></td></tr></table></div></td></tr><tr><center><td width=100% height=20 valign=bottom></center><div align=center><table border=0 width=586 height=20 cellspacing=0 cellpadding=0><tr><td width=135 background=../img/line3.gif><p align=right><img border=0 src=../img/line.gif width=9 height=20></td><center><td width=310 valign=bottom><p align=center class=9ptV><a href=32.htm class=link2><font color=#4048A8>poprzednia strona</font></a><font color=#4048A8> :: </font><a href=spis.htm class=link2><font color=#4048A8>spis tre¶ci</font></a><font color=#4048A8> :: </font><a href=34.htm class=link2><font color=#4048A8>nastêpna strona</font></a></td><td width=135 background=../img/line3.gif><img border=0 src=../img/line2.gif width=9 height=20></td></tr></table></center></div></td></tr><tr><td width=100% height=20 valign=top>&nbsp;</td></tr><tr><td width=100% height=25 valign=middle bgcolor=#4048A8><div align=center><table border=0 width=583 cellspacing=0 cellpadding=0><center><td width=596 class=9ptV valign=bottom colspan=6><p class=9ptV align=center><font color=#FFFFFF><b>WSZELKIE PRAWA ZASTRZE¯ONE :: COPYRIGHT &copy; MAGAZIN 2001-2002</b></font></td></center><center></table></center></div></td></tr><tr><td width=100% height=20 valign=top>&nbsp;</td></tr></table></div></body></html>