<html><head><meta http-equiv=Content-Type content="text/html; charset=iso-8859-2"><link rel=stylesheet href=magazin.css TYPE=text/css><title>MagaZin #15 :: luty 2003</title></head><body link=#478DE7 vlink=#478DE7 alink=#478DE7 topmargin=0 bottommargin=0 bgcolor=#000000><div align=center><table border=0 width=650 style="border-style: solid; border-width: 0" cellspacing=0 cellpadding=0 bgcolor=#FFFFFF><tr><td width=100% height=70 valign=middle background=../img/003b.png><div align=center><table border=0 width=550 cellspacing=0 cellpadding=0 height=28><tr><td width=550 align=center height=26 valign=bottom><p class=9ptV align=right><font color=#FFFFFF><b>MAGAZIN #15 :: STRONA 27</b></font></td></tr></table></div></td></tr><center><tr><td width=100% height=20 valign=bottom></center><div align=center><table border=0 width=586 height=20 cellspacing=0 cellpadding=0><tr><td width=135 background=../img/line3.gif><p align=right><img border=0 src=../img/line.gif width=9 height=20></td><center><td width=310 valign=bottom><p align=center class=9ptV><a href=26.htm class=link2><font color=#2078A8>poprzednia strona</font></a><font color=#4048A8> </font><font color=#2078A8>::</font><font color=#4048A8> </font><a href=spis.htm class=link2><font color=#2078A8>spis tre¶ci</font></a><font color=#4048A8> </font><font color=#2078A8>::</font><font color=#4048A8> </font><a href=28.htm class=link2><font color=#2078A8>nastêpna strona</font></a></td><td width=135 background=../img/line3.gif><img border=0 src=../img/line2.gif width=9 height=20></td></tr></table></center></div></td></tr><center><tr><td width=100% height=5 valign=top><p class=9ptV>&nbsp;</td></tr><tr><td width=100% height=5 valign=top><div align=center><center><table border=0 width=600 cellspacing=0 cellpadding=0><tr><td width=590 valign=top class=9ptV height=20 style="border-bottom: 1 solid #2078A8"><b><font color=#009830><img border=0 src=../img/kwad.gif width=8 height=8> </font></b><b><font color=#2078A8>KURSY</font></b></td></tr><tr><td width=586><p><font face=Impact size=7 color=#E0F0F8><span style="background-color: #2078A8">K</span></font><font color=#000000 size=7 face=Impact>urs Delphi, cz. 6</font></td></center></center></tr><center><center><tr><td width=588 valign=bottom class=9ptV height=20><font color=#009830><img border=0 src=../img/goto3.gif width=8 height=8> </font><a href=mailto:przempc@poczta.onet.pl class=link2><b><font color=#2078A8>PC3T</font></b></a></td></tr><tr><td width=588 height=10></td></tr></table></center></div></center></td></tr><tr><td width=100% height=21 valign=top background=../img/back3.gif><div align=center><center><table border=0 width=600 cellspacing=0 cellpadding=6><tr><td width=50% valign=top><p align=justify class=9ptV style="line-height: 130%"><font color=#1F77A4>Dzisiaj zajmiemy siê plikami. Nauczymy siê je otwieraæ, wczytywaæ zawarto¶æ, zapisywaæ dane i zamykaæ plik. Zrobimy to na dwa sposoby. Tak wiêc zakoñczê ten wstêp.</font><br> <br> <font face=Tahoma><img border=0 src=../img/bl2/003_d.gif style="float: left; margin-right: 4; margin-top: 4" width=25 height=40></font>elphi tak jak ka¿dy inny jêzyk programowania umo¿liwia operacje na plikach (sprostowanie: Object Pascal jest tym jêzykiem, a nie Delphi :)). My zajmiemy siê na razie ich otwieraniem i wczytywaniem danych. Na pocz±tku uruchomcie Delphi. Napiszemy teraz program w Delphi, ale bêdzie on tylko do pojêcia podstaw, wiêc odpu¶æmy sobie ustawianie w³a¶ciwo¶ci okien. Wstawmy natomiast do niego: TMemo, TEdit i TButton. W Memo znajd¼cie w³a¶ciwo¶æ Lines i edytujcie j± czyszcz±c ca³± zawarto¶æ. ScrollBars ustawcie natomiast na ssVertical. Wyczy¶cie te¿ zawarto¶æ Text dla komponentu TEdit. To by by³o na tyle z wizualnego pisania. Kliknijcie dwukrotnie na TButton (jego Caption ustawcie na Otwórz) i...<br> Aby nasz program umia³ otwieraæ pliki potrzebna jest nam zmienna typu TextFile:<br> <br> <font color=#1F77A4>var plik: TextFile;</font><br> <br> Teraz musimy skojarzyæ zmienn± plik z plikiem o nazwie, któr± bêdziemy mieli w komponencie TEdit (w³a¶ciwo¶æ Text). S³u¿y do tego procedura AssignFile(var F: File; FileName: String). Pó¼niej wypada³oby otworzyæ ten plik procedur± Reset(F: File). Procedura ta otwiera plik i ustawia siê na jego pocz±tku. Je¶li plik nie istnieje to mówi nam o b³êdzie i zawiesza program. Dlatego na samym pocz±tku procedury musimy daæ taki warunek:<br> <br> <font color=#1F77A4>if FileExists(Edit1.Text) then</font><br> <br> Wtedy unikniemy niepotrzebnych b³êdów. Powy¿sza funkcja ma budowê: FileExists(FileName: String): Boolean i sprawdza czy dany plik istnieje. Idziemy dalej. Teraz musimy wczytaæ dane z pliku. Pos³u¿y nam do tego procedura Readln(F: File; S: String). Jednak gdy napiszmy tylko tak:<br> <br> <font color=#1F77A4>Readln(plik, s)</font><br> <br> To wczytamy z pliku tylko jedn± pierwsz± linijkê. Potrzebna nam bêdzie pêtla while... do, która bêdzie sprawdza³a funkcj± Eof(F: File): Boolean czy skoñczy³ siê ju¿ plik (czy doszli¶my ju¿ do ostatniej linijki). Tak to bêdzie wygl±da³o:<br> <br> <font color=#1F77A4>while not eof(plik) do</font><br> <br> W tym warunku damy a¿ dwa inne zadania dla programu. Bêdzie wczytywa³ linijkê z pliku pod zmienn± s:String i wpisywa³ j± do TMemo, pó¼niej pêtla bêdzie siê powtarza³a itd. Na koniec zamkniemy jescze plik procedur± CloseFile(F: File) i damy dokoñczenie warunku na samym pocz±tku procedury:<br> <br> <font color=#1F77A4>else<br> ShowMessage('Plik o nazwie ' + Edit1.Text + ' nie istnieje!');</font><br> <br> Je¶li jeste¶ inteligentny i b³yskotliwy to ju¿ powiniene¶ mieæ t± procedurê bez patrzenie poni¿ej, a to dla tych co tak szybko nie ³api±:<p align=left class=9ptV style="line-height: 130%"><font color=#1F77A4>procedure TForm1.Button1Click(Sender: TObject);<br> var<br> plik: TextFile;<br> s:String;<br> begin<br> Memo1.Clear;<br> if FileExists(Edit1.Text) then<br> begin<br> AssignFile(plik, Edit1.Text);<br> Reset(plik);<br> while not eof(plik) do<br> begin<br> readln(plik, s);<br> Memo1.Lines.Add(s);<br> end;<br> CloseFile(plik);<br> end<br> else<br> ShowMessage('Plik o nazwie ' + Edit1.Text + ' nie istnieje!');<br> end;</font><p align=justify class=9ptV style="line-height: 130%">Dlaczego nie wczyta³em ca³ej zawarto¶ci pliku do jednej zmiennej, a co dopiero pó¼niej nie wypisa³em tego na ekranie? Otó¿ za ka¿dym razem gdy pisa³em Readln(plik, s); warto¶æ zmiennej s siê zerowa³a i podstawia³em pod ni± now± linijkê. Mo¿na by³o jeszcze zrobiæ tak:<br> <br> <font color=#1F77A4>while not eof(plik) do<br> begin<br> readln(plik, s);<br> tekst := tekst + s;<br> end;</font><br> <br> Ale wtedy zlewa³oby siê to w jedn± linijkê tj. tekst by³by podstawiany do zmiennej tekst linijka za linijk±, ale bez entera! Dlatego radzê korzystaæ z obiektu TStrings, który ma procedurê Add (np.: TMemo ma w³a¶ciwo¶æ Lines, która nie jest niczym innym jak TStrings!). Dla zrozumienia powy¿sza procedurka, ale z wykorzystaniem obiektu TStringList:<p align=left class=9ptV style="line-height: 130%"><font color=#1F77A4>procedure TForm1.Button1Click(Sender: TObject);<br> var<br> plik: TextFile;<br> s:String;<br> Stringi:TStringList;<br> begin<br> Stringi := TStringList.Create;<br> Memo1.Clear;<br> if FileExists(Edit1.Text) then<br> begin<br> AssignFile(plik, Edit1.Text);<br> Reset(plik);<br> while not eof(plik) do<br> begin<br> readln(plik, s);<br> Stringi.Add(s);<br> end;<br> CloseFile(plik);<br> Memo1.Text := Stringi.Text;<br> end<br> else<br> ShowMessage('Plik o nazwie ' + Edit1.Text + ' nie istnieje!');<br> end;</font><p align=justify class=9ptV style="line-height: 130%">Obydwie procedurki s± tak samo efektywne, wiêc korzystajcie z której chcecie. :) Jednak ja znam jeszcze szybszy i prostszy sposób. Zdziwicie siê jak prosty sposób. ;)<p align=left class=9ptV style="line-height: 130%"><font color=#1F77A4>procedure TForm1.Button1Click(Sender: TObject);<br> begin<br> if FileExists(Edit1.Text) then<br> Memo1.Lines.LoadFromFile(Edit1.Text);<br> else<br> ShowMessage('Plik o nazwie ' + Edit1.Text + ' nie istnieje!');<br> end;</font><p class=9ptV style="line-height: 130%" align=justify>Za¿y³em was? :) Jak widzicie wczytywanie pliku do Memo to jedna linijka! Jednak pod t± linijk± kryje siê mniej wiêcej taka sama procedura jak± napisali¶my parê wierszy wy¿ej.<br> Nastêpnym krokiem bêdzie zapisanie danych do pliku. Jak siê domy¶lacie s± tak samo dwa sposoby: d³u¿sza procedura i przez obiekt Memo. Najpierw zajmiemy siê t± d³u¿sz±, bo mo¿e siê wam w przysz³o¶ci bardziej przydaæ. Tak samo jak w wczytywaniu musimy zadeklarowaæ zmienn± TextFile oraz skojarzyæ j± z nazw± pliku zawart± w Edit1:<br> <br> <font color=#1F77A4>var plik: TextFile;<br> begin<br> AssignFile(plik, Edit1.Text);</font><br> <br> Teraz zaczynaj± siê schody, ale trochê krótsze od tych ni¿ej (bo schody s± trudne, gdy siê idzie pod górê, nie? :)).</td><td width=50% valign=top><p align=justify class=9ptV style="line-height: 130%">Musimy utworzyæ plik lub wyczy¶ciæ jego zwarto¶æ procedur±<br> <br> <font color=#1F77A4>Rewrite(plik);</font><br> <br> Tym razem nie musimy sprawdzaæ czy plik istnieje. Pó¼niej zostaje ju¿ tylko zapisanie danych&nbsp;<br> <br> <font color=#1F77A4>writeln(plik, Memo1.Text);</font><br> <br> Oraz zamkniêcie pliku:<br> <br> <font color=#1F77A4>CloseFile(plik);</font><br> <br> Wszystko bêdzie wygl±da³o tak:</center><p align=left class=9ptV style="line-height: 130%"><font color=#1F77A4>procedure TForm1.Button1Click(Sender: TObject);<br> var<br> plik: TextFile;<br> begin<br> AssignFile(plik, Edit1.Text);<br> Rewrite(plik);<br> writeln(plik, Memo1.Text);<br> CloseFile(plik);<br> end;</font><center><p align=justify class=9ptV style="line-height: 130%">Jak siê domy¶lacie teraz powiem wam drugi sposób:</center><p align=left class=9ptV style="line-height: 130%"><font color=#1F77A4>procedure TForm1.Button1Click(Sender: TObject);<br> begin<br> Memo1.Lines.SaveToFile(Edit1.Text);<br> end;</font><center><p align=justify class=9ptV style="line-height: 130%">To siê nazywa przegiêcie, nie?&nbsp;<br> <br> <b>Atrybuty plików</b><br> <br> Pisa³em ju¿ o plikach tekstowych, a nie napisa³em bardzo wa¿nej rzeczy o samych plikach: atrybuty plików. Czyli jak je odczytywaæ, zapisywaæ i jak dodaæ do atrybutów pliku nowy atrybut, ¿eby nie zmieniæ innych. Na pocz±tek dowiedzmy siê jakie mamy atrybuty:<br> <br><div align=center><center><table border=0 width=100% cellspacing=0 cellpadding=0 style="border-top: 1 solid #1F77A4; border-bottom: 1 solid #1F77A4"><tr><td width=100% colspan=2 height=10></td></tr><tr><td width=50% class=9ptV align=center valign=top><font color=#1F77A4><b>Atrybut</b></font></td><td width=50% class=9ptV align=center valign=top><font color=#1F77A4><b>Sta³a w Delphi</b></font></td></tr><tr><td width=100% class=9ptV valign=top align=center colspan=2 height=10></td></tr><tr><td width=50% class=9ptV valign=top><p align=center>Tylko do odczytu<br> (Read Only)</td><td width=50% class=9ptV valign=middle><p align=center>faReadOnly</td></tr><tr><td width=100% class=9ptV valign=top align=center colspan=2 height=10></td></tr><tr><td width=50% class=9ptV valign=top align=center><p align=center>Ukryty<br> (Hidden)</td><td width=50% class=9ptV valign=middle align=center>faHidden</td></tr><tr><td width=100% class=9ptV valign=top align=center colspan=2 height=10></td></tr><tr><td width=50% class=9ptV valign=top align=center>Systemowy<br> (System)</td><td width=50% class=9ptV valign=middle align=center>faSysFile</td></tr><tr><td width=100% class=9ptV valign=top align=center colspan=2 height=10></td></tr><tr><td width=50% class=9ptV valign=top align=center>Archiwalny<br> (Archive)</td><td width=50% class=9ptV valign=middle align=center>faArchive</td></tr><tr><td width=100% class=9ptV valign=top align=center colspan=2 height=10></td></tr></table></center></div><p align=justify class=9ptV style="line-height: 130%">Pierwsze kroki mamy za sob± (szczegó³, ¿e jeszcze nic nie wiemy ;). Przejd¼my dalej. Zapewne umiesz otwieraæ plik, zapisywaæ go itp. i wiesz ile potrzeba wtedy zmiennych (je¶li nie wiesz to przeczytaj czê¶æ kursu powy¿ej). ¯eby bawiæ siê w atrybutach pliku potrzebna nam tylko jedna zmienna: Integer, bo w³a¶nie w takiej postaci przechowywane s± atrybuty pliku. Dok³adniej: zapisane s± one w bitach, np.: je¶li bit zerowy ma warto¶æ 1, to plik jest tylko do odczytu, je¶li jeszcze jest zaznaczony bit pierwszy to plik jest jeszcze ukryty (itd). Kiedy tworzysz nowy plik to wszystkie bity przyjmuj± warto¶æ 0. W Delphi na szczê¶cie nie musimy bawiæ siê bezpo¶rednio w bitach. Dobra, dobra zróbmy co¶ wreszcie:<br> <br> <font color=#1F77A4>var<br> atrybuty:Integer;<br> begin<br> atrybuty := FileGetAttr('test.txt');</font><br> <br> W powy¿szym przyk³adzie pobieramy, za pomoc± funkcji FileGetAttr, z pliku test.txt jego atrybuty i podstawiamy je pod zmienn± "atrybuty". No dobra tylko co nam z tego, ¿e mamy atrybuty w zmiennej skoro dalej ich nie mamy? :) Poni¿szy przyk³ad poka¿e to Wam, tylko do naszego formularza wstawcie najpierw cztery obiekty TCheckBox i:</center><p align=left class=9ptV style="line-height: 130%"><font color=#1F77A4>var<br> atrybuty: Integer;<br> begin<br> atrybuty := FileGetAttr('test.txt');<br> if atrybuty and faReadOnly = faReadOnly then<br> CheckBox1.Checked := True<br> else CheckBox1.Checked := False;<br> if atrybuty and faHidden = faHidden then<br> CheckBox2.Checked := True<br> else CheckBox2.Checked := False;<br> if atrybuty and faSysFile = faSysFile then<br> CheckBox3.Checked := True<br> else CheckBox3.Checked := False;<br> if atrybuty and faArchive = faArchive then<br> CheckBox4.Checked := True<br> else CheckBox4.Checked := False;<br> end;</font><center><p align=justify class=9ptV style="line-height: 130%">¦wietnie! Robimy postêpy. Jak zauwa¿yli¶cie pierwszy obiekt TCheckBox jest od plików Tylko do odczytu, drugi od plików ukrytych, trzeci od plików systemowych, a czwarty od archiwalnych. Zanim wyt³umaczê dok³adniej uruchomcie program i sprawd¼cie czy wszystko gra, a pó¼niej chocia¿by Eksploratorem upewnijcie siê czy ustawienia s± takie same, je¶li tak to zmieñcie je i jeszcze raz uruchomcie program. Gra?<br> Teraz pora na dok³adniejsze t³umaczenie. Jak siê domy¶lacie chodzi mi o te linijki:</center><p align=left class=9ptV style="line-height: 130%"><font color=#1F77A4>if atrybuty and faReadOnly = faReadOnly then //</font><center><p align=justify class=9ptV style="line-height: 130%">... i tak dalej<br> <br> Zmienna "atrybuty" mo¿e przyj±æ wiêcej ni¿ jeden atrybut pliku, wiêc gdyby¶my dali:<br> <br> <font color=#1F77A4>if atrybuty = faReadOnly then {...}</font><br> <br> to obiekt TCheckBox by³by zaznaczony tylko wtedy, gdy nasz plik ma TYLKO zaznaczony atrybut faReadOnly. Dziêki ³±cznikowi "and" mo¿emy zaznaczyæ TCheckBox je¶li jeden z atrybutów równy jest faReadOnly. Nie bêdê wnika³ w szczegó³y, bo to wymaga zabawy z bitami, a przyznam szczerze, ¿e i ja nie rozumiem za bardzo tego przyk³adu na bitach. Od razu przechodzimy do zapisywania atrybutów. Robimy to za pomoc± procedury FileSetAttr. A wygl±da to tak:<br> <br> <font color=#1F77A4>FileSetAttr('test.txt',faReadOnly);</font><br> <br> Budowy chyba nie muszê t³umaczyæ, bo wszystko widaæ na przyk³adzie. Jak to bywa we wszystkich procedurach jest pewien haczyk, bo gdy bêdziemy chcieli tylko dodaæ nowy atrybut to zaczn± siê schody, gdy¿ przy u¿yciu powy¿szego przyk³adu ustawimy atrybut faReadOnly na jeden, a resztê wyzerujemy. Jest jednak sposób. Mo¿emy najpierw pobraæ atrybuty z pliku, podstawiæ je pod zmienn±, dodaæ nowy atrybut, a je¶li taki jest zaznaczony to nic nie robiæ i zapisaæ je wszystkie. Dziêki temu wszystko siê uda, tylko jak to zrobiæ? Poni¿szy przyk³ad poka¿e wam:</center><p align=left class=9ptV style="line-height: 130%"><font color=#1F77A4>var<br> atrybuty: Integer;<br> begin<br> atrybuty := FileGetAttr('test.txt'); // pobieramy atrybuty<br> atrybuty := atrybuty or faReadOnly;//dodajemy nowy atrybut<br> FileSetAttr('test.txt', atrybuty);</font><center><p align=justify class=9ptV style="line-height: 130%">Oczywi¶cie resztê atrybutów dodaje siê tak samo tylko nazwê atrybutu musimy zmieniæ. My¶lê, ¿e ta druga czê¶æ tego odcinka te¿ siê wam przyda. Z atrybutów plików raczej rzadko siê korzysta, ale dla samego siebie lepiej wiedzieæ jak albo chocia¿ wiedzieæ gdzie mo¿na znale¼æ. :) Nastêpnym razem zajmiemy siê edytorem tekstu, takim co najmniej Notatnikiem, ale siê zobaczy jeszcze. :)</center><div align=center><table border=0 width=100% cellspacing=0 cellpadding=0><center><tr><td width=100%><p align=right class=9ptV><font face=Arial size=1><br> <a href=http://www.magazin.prv.pl><img border=0 src=../img/cd.gif width=47 height=20></a></font></p></td></tr></table></div></center></td></tr></table></div></td></tr><tr><center><td width=100% height=20 valign=bottom></center><div align=center><table border=0 width=586 height=20 cellspacing=0 cellpadding=0><tr><td width=135 background=../img/line3.gif><p align=right><img border=0 src=../img/line.gif width=9 height=20></td><center><td width=310 valign=bottom><p align=center class=9ptV><a href=26.htm class=link2><font color=#2078A8>poprzednia strona</font></a><font color=#4048A8> </font><font color=#2078A8>::</font><font color=#4048A8> </font><a href=spis.htm class=link2><font color=#2078A8>spis tre¶ci</font></a><font color=#4048A8> </font><font color=#2078A8>::</font><font color=#4048A8> </font><a href=28.htm class=link2><font color=#2078A8>nastêpna strona</font></a></td><td width=135 background=../img/line3.gif><img border=0 src=../img/line2.gif width=9 height=20></td></tr></table></center></div></td></tr><tr><td width=100% height=65 valign=top background=../img/003c.png><div align=center><center><table border=0 width=592 cellspacing=0 cellpadding=0 height=55><tr><td width=590 height=55><p align=center class=9ptV><b><font color=#FFFFFF>WSZELKIE PRAWA ZASTRZE¯ONE :: COPYRIGHT &copy; MAGAZIN 2001-2003</font></b></td></tr></table></center></div></td></tr></table></div></body></html>